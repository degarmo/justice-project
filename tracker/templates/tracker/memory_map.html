{% extends "tracker/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid px-0" style="padding-top: 5rem;">
    <div class="row g-0">
        <!-- Google Map: 70% -->
        <div class="col-md-8" style="height: 80vh;">
            <div id="map" style="height: 100%; width: 100%;"></div>
        </div>

        <!-- Messages Panel: 30% -->
        <div class="col-md-4 bg-light p-4 " style="height: 80vh; overflow-y: scroll;">
            <h4 class="mb-4">Messages of Love</h4>
            {% for msg in messages %}
                <div class="mb-3">
                    <strong>{% if msg.is_anonymous %}Anonymous{% else %}{{ msg.display_name }}{% endif %}</strong>
                    {% if msg.show_location %}
                        <small class="text-muted">from {{ msg.city }}, {{ msg.state }}</small>
                    {% endif %}
                    <p class="mb-1">{{ msg.message }}</p>
                    <small class="text-muted">{{ msg.created_at|date:"F j, Y, g:i a" }}</small>
                    <hr>
                </div>
            {% empty %}
                <p>Be the first to leave a message.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function initMap() {
      const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: { lat: 39.5, lng: -98.35 }
      });
  
      const locations = {{ messages_json|safe }};
  
      console.log("Loaded locations:", locations);  // Debug output
  
      locations.forEach(loc => {
        if (loc.latitude && loc.longitude) {
          new google.maps.Marker({
            position: { lat: loc.latitude, lng: loc.longitude },
            map: map,
            title: loc.display_name || "Anonymous"
          });
        }
      });
    }
  
    // Ensure map loads on page render
    window.initMap = initMap;
  </script>
<!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAtjZE5pRf_kM-P3l2mDTItjg9KgA7RgDE"></script>

    <script src="{% static 'tracker/js/gps_autofill.js' %}"></script>

{% endblock %}
